<!doctype html>
<html>

	<head>
		<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
		<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
		<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
		<link rel="manifest" href="/site.webmanifest">
		<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
		<meta name="msapplication-TileColor" content="#da532c">
		<meta name="theme-color" content="#ffffff">
		
		<style>
			.center {
				margin: auto;
				width: 100%;
				padding: 0px;
				text-align: left;
			}

			input {
				line-height: 6em;
			}
		</style>
	</head>

	<body onload="main()"" style="background-color:#282828">

		<div class="center">
			<p id="scantext" style="text-shadow: 3px 3px #d79921; color: #fabd2f; opacity: 100; font-size: 10vw; font-family:'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif"></p>
		</div>
		
		<p id="doc" style="opacity: 0;">abc</p>
		
	</body>
	
	<!--
		https://docs.google.com/forms/d/e/1FAIpQLSf_Z3nol0PQztbRLilbfIA4XSbIXMroVQyyDc-SIpTzkSK5Eg/formResponse?&entry.1267494256=oof&submit=SUBMIT

		RickRoll
		dQw4w9WgXcQ

		September - Earth, Wind and Fire
		Gs069dndIYk

		AllStar - SmashMouth
		L_jWHffIx5E

		EEEAAAOOO - My Fucking Mess
		v1K4EAXe2oo

		Skeleton Dance - Silly Symphonies
		vOGhAV-84iI

		Tort Brush Mambo
		ZRTCwquyCHc

		Get Stick Bugged lol
		Tt7bzxurJ1I

		got legs?
		gSsJBO2JUO4

		he 10 hours
		3SCBYUE_X1U

		James May says Cheese
		SyimUCBIo6c

		Thurston the Cat (Full video)
		RRNanbmD1xk

		vibin'
		qMQ-y9dHE2k

		Sax Seal
		hgwpZvTWLmE

		Smooth Criminal
		h_D3VFfhvs4
	-->

	<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.js"></script>
	<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
	<script>
		
		async function main() 
		{
			var LinkFor = ["MARTIN"];

			var AlertFor = [];
			var Alert = "Have a Wonderful Day, Scan me later";
			
			var GoogleAppScriptURL = 'https://script.google.com/macros/s/AKfycbw8waD2-Pft8NsNB55HZVrCuyWdXlOBg0y9hrYyU90bZOvvdxf_gM1sKLGOouZuESLC/exec';

			
			var indicator = window.location.search;
			indicator = indicator.substring(1);

			console.log(indicator);

			try{
				await getIP();
				var ip = document.getElementById('doc').innerHTML;
				var hash = CryptoJS.SHA256(ip).toString();

				var User = await fetch(GoogleAppScriptURL, {
					method: 'POST',
					body: JSON.stringify({
						'Ip': hash,
						'Time': formatAMPM(new Date()),
						'Indicator' : indicator
					})
				}).then(response => response.json().then(data => data));

				console.log(User);

				var found = false;
				for(var x of AlertFor) {
				  if(x == indicator) found = true;
				  if(found) break;
				}

				var ScannedFromLink = false;
				for (var x of LinkFor) {
					if (x == indicator) ScannedFromLink = true;
					if (ScannedFromLink) break;
				}

				if(found)	document.getElementById('scantext').innerHTML = Alert;
				else
				{
					if (User.Count == 1)	RickRoll(false);
					else if(User.Count == 2)	document.getElementById('scantext').innerHTML = ScannedFromLink ? "Trying to open me twice I see?<br>But will you do it thrice?" : "Hey! No Double Scansies!";
					else if (User.Count == 3)	document.getElementById('scantext').innerHTML = ScannedFromLink ? "I guess third time was not the charm" : "Hey! No Triple Scansies!<br>No more Scanning!";
					else if (User.Count == 4)	document.getElementById('scantext').innerHTML = ScannedFromLink ? "Will you stop already!" : "Hey! No Quadruple Scansies!<br>Will you stop already!";
					else if (User.Count == 5) 	document.getElementById('scantext').innerHTML = ScannedFromLink ? "5 times opening me, really?!<br>Do you think something new will happen?" : "Hey! No Quintuple Scansies!<br>Do you think something new will happen?";
					else if (User.Count == 6) 	document.getElementById('scantext').innerHTML = ScannedFromLink ? "6 times!<br>Is it really worth the effort?" : "Hey! No Hextuple Scansies!<br>Is it really worth the effort?";
					else if (User.Count == 7) 	document.getElementById('scantext').innerHTML = "Is it truly worth it?";
					else if (User.Count == 8) 	document.getElementById('scantext').innerHTML = "...";
					else if (User.Count == 9)	document.getElementById('scantext').innerHTML = 'Do you want some kinda of prize or something mate?';
					else if (User.Count == 10)	document.getElementById('scantext').innerHTML = 'Fine, Scan it again to get your prize';
					else if (User.Count == 11)	RickRoll(true);
					else if (User.Count == 12)	document.getElementById('scantext').innerHTML = 'haha, gottem';
					else if (User.Count == 13)	document.getElementById('scantext').innerHTML = 'what, you want an actual prize';
					else if (User.Count == 14)	document.getElementById('scantext').innerHTML = 'Fine';
					else if (User.Count > 14)	document.getElementById('scantext').innerHTML = 'â™¥';
					else	document.getElementById('scantext').innerHTML = 'Seems like something broke, sorry about that. Im always working on making this QR Code Better';
				}
			}
			catch (error) {
				
				var User = await fetch(GoogleAppScriptURL, {
					method: 'POST',
					body: JSON.stringify({
						'Ip': 'Could not Get IP',
						'Time': formatAMPM(new Date()),
						'Indicator': indicator
					})
				}).then(response => response.json().then(data => data));

				RickRoll(true);
			}
		}

		async function RickRoll(ForceRickRoll)
		{
			var CommonVideoLinks = [
				'dQw4w9WgXcQ'
			]
			var RareVideoLinks = [
				'Gs069dndIYk',
				'L_jWHffIx5E',
				'v1K4EAXe2oo',
				'vOGhAV-84iI',
				'ZRTCwquyCHc',
				'Tt7bzxurJ1I',
				'gSsJBO2JUO4',
				'3SCBYUE_X1U',
				'SyimUCBIo6c',
				'RRNanbmD1xk',
				'qMQ-y9dHE2k',
				'hgwpZvTWLmE'
			]

			const ChanceOfRare = 1 / 32;
			var CommonOrRare = Math.round(Math.random()) > ChanceOfRare ? false : true;
			var ChosenVideoId;

			if (CommonOrRare || ForceRickRoll) {
				ChosenVideoId = CommonVideoLinks[Math.floor(Math.random() * (CommonVideoLinks.length))];
			}
			else {
				ChosenVideoId = RareVideoLinks[Math.floor(Math.random() * (RareVideoLinks.length))];
			}

			var ChosenVideoUrl = 'https://youtu.be/' + ChosenVideoId;

			var JsonUrl = 'https://noembed.com/embed?url=https://www.youtube.com/watch?v=' + ChosenVideoId;
			var ChosenVideoTitle = await GetJsonTitle(JsonUrl);

			LoadVideo(ChosenVideoUrl);
		}

		async function GetSpreadSheetData(url)
		{
			var GetSheetHashedIps = await fetch(url,
			{
				// mode: 'no-cors',
			}).then(Response => Response.json());

			return await GetSheetHashedIps;
		}

		async function GetJsonTitle(JsonUrl)
		{
			return await fetch(JsonUrl).then(Response => Response.json()).then((out) => { return out.title});
		}

		function LoadVideo(url) {
			setTimeout(function () {
				window.location = url;
				}, 1000);
			}

		function formatAMPM(date) {
			// gets the hours
			var hours = date.getHours();
			// gets the day
			var days = date.getDay();
			// gets the month
			var minutes = date.getMinutes();
			// gets AM/PM
			var ampm = hours >= 12 ? 'pm' : 'am';
			// converts hours to 12 hour instead of 24 hour
			hours = hours % 12;
			// converts 0 (midnight) to 12
			hours = hours ? hours : 12; // the hour '0' should be '12'
			// converts minutes to have leading 0
			minutes = minutes < 10 ? '0' + minutes : minutes;

			// the time string
			var time = hours + ':' + minutes + ' ' + ampm;

			// gets the match for the date string we want
			var match = date.toString().match(/\w{3} \w{3} \d{1,2} \d{4}/);

			//the result
			return match[0] + ' ' + time;
		}

		async function getIP(json) {
			await fetch("https://api.ipify.org")
				.then(res => res.text())
				.then(data => document.getElementById('doc').innerHTML = data);
		}

	</script>
</html>
